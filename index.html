<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Veri Giriş Formu</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-search@3.0.2/dist/leaflet-search.min.css" />
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-search@3.0.2/dist/leaflet-search.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif;  padding: 20px; }
        #map { height: 400px; width: 100%; }
        form { display: flex; flex-direction: column; gap: 10px; }
        label { font-weight: bold; }
        input, select, textarea { width: 100%; padding: 5px; }
        button { padding: 10px; background-color: #4CAF50; color: white; border: none; cursor: pointer; }
        #message { margin-top: 20px; padding: 10px; border-radius: 5px; }
        .success { background-color: #dff0d8; color: #3c763d; }
        .error { background-color: #f2dede; color: #a94442; }

        /* Basemap seçiminin görünümü için düzenleme */
        .leaflet-control-layers-list {
            list-style: none;
            padding: 0;
            display: flex; /* Basemap seçeneklerini aynı satıra yerleştir */
            flex-direction: column; /* Seçenekleri sütun olarak hizala */
            gap: 10px; /* Her bir satır arasında boşluk */
        }

        .leaflet-control-layers-list li {
            display: flex;
            flex-direction: row; /* Öğeleri yatayda hizalar */
            align-items: center; /* Buton ve metni dikeyde ortalar */
            justify-content: space-between; /* Buton ile label arasında boşluk bırakır */
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 3px;
            margin-bottom: 5px;
        }

        .leaflet-control-layers-list label {
            margin-left: 10px;
            flex-grow: 1; /* Label'ı genişleterek boşluğu doldurmasını sağlar */
        }

        .leaflet-control-layers-list input[type="radio"],
        .leaflet-control-layers-list input[type="checkbox"] {
            margin-right: 10px;
        }

        /* Mobil cihazlar için ek CSS */
        @media (max-width: 768px) { /* 768px'in altında mobil cihazlar için */
            .leaflet-control-layers-list {
                flex-direction: column; /* Seçenekleri sütun olarak hizala */
            }
            .leaflet-control-layers-list li {
                width: 100%; /* Her seçeneğin genişliği %100 olsun */
            }
        }
    </style>
</head>
<body>
    <h1>Veri Giriş Formu</h1>

    <div id="map"></div>

    <label for="konum">Konum:</label>
    <p id="coordinates"></p>

    <form id="dataForm">
        <label for="sayi">Sayı:</label>
        <input type="number" id="sayi" name="sayi" required>

        <label for="tarih">Tarih:</label>
        <input type="date" id="tarih" name="tarih" required>

        <label for="secim">Seçim:</label>
        <select id="secim" name="secim" required>
            <option value="">Seçiniz</option>
            <option value="secenek1">Seçenek 1</option>
            <option value="secenek2">Seçenek 2</option>
            <option value="secenek3">Seçenek 3</option>
        </select>

        <label for="aciklama">Açıklama:</label>
        <textarea id="aciklama" name="aciklama"></textarea>

        <label for="notlar">Notlar:</label>
        <textarea id="notlar" name="notlar"></textarea>

        <label for="foto">Fotoğraf:</label>
        <input type="file" id="foto" name="foto" accept="image/*">

        <button type="submit">Kaydet</button>
    </form>

    <div id="message"></div>

    <script>
        // Harita oluştur
        const map = L.map('map').setView([41.0082, 28.9784], 13);

        // Google Maps Uydu Görüntüsü
        const googleMapsSatelliteLayer = L.tileLayer('https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
            attribution: '© <a href="https://maps.google.com/maps/about/terms/copyright/">Google Maps</a>',
            maxZoom: 22 // Maksimum zoom seviyesini 22'ye ayarlayın
        });

        // Google Maps Uydu Görüntüsü ile Etiketler
        const googleMapsSatelliteWithLabelsLayer = L.tileLayer('https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}', { // Doğru URL
            attribution: '© <a href="https://maps.google.com/maps/about/terms/copyright/">Google Maps</a>',
            maxZoom: 22 
        });

        // Google Maps Harita
        const googleMapsLayer = L.tileLayer('https://mt1.google.com/vt/lyrs=m&x={x}&y={y}&z={z}', {
            attribution: '© <a href="https://maps.google.com/maps/about/terms/copyright/">Google Maps</a>',
            maxZoom: 22 // Maksimum zoom seviyesini 22'ye ayarlayın
        });

        // OpenStreetMap katmanı
        const osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            maxZoom: 22 // OpenStreetMap için de maxZoom'u 22'ye ayarladık.
        });

        // Katman kontrolü ekle (basemapleri değiştirmek için)
        const layersControl = L.control.layers({
            "Google Maps (Uydu)": googleMapsSatelliteLayer, // Varsayılan olarak Google Maps Uydu
            "Google Maps (Uydu Etiketli)": googleMapsSatelliteWithLabelsLayer, 
            "Google Maps (Harita)": googleMapsLayer, 
            "OpenStreetMap": osmLayer
        }, {}, { position: 'topright' }).addTo(map); // autoZIndex: false

        // Başlangıçta Google Maps Uydu Görüntüsü katmanını göster
        googleMapsSatelliteLayer.addTo(map); 

        // Arama kontrolü ekle
        const searchControl = new L.Control.Search({
            url: 'https://nominatim.openstreetmap.org/search?format=json&q={s}',
            jsonpParam: 'json_callback',
            propertyName: 'display_name',
            propertyLoc: ['lat','lon'],
            marker: L.circleMarker([0,0],{radius:30}),
            autoCollapse: true,
            autoType: false,
            minLength: 2
        });

        let searchMarker; // Arama sonucu marker'ı için değişken

        searchControl.on('search:locationfound', function(e) {
            if (searchMarker) {
                map.removeLayer(searchMarker); // Önceki marker'ı kaldır
            }
            lat = e.latlng.lat;
            lon = e.latlng.lng;
            searchMarker = L.circleMarker(e.latlng, {radius: 30}).addTo(map); // Yeni marker ekle
            document.getElementById('coordinates').innerHTML = `Seçilen Konum: ${lat.toFixed(4)}, ${lon.toFixed(4)}`;
        });

        map.on('click', function(e) {
            if (searchMarker) { // Arama marker'ı varsa kaldır
                map.removeLayer(searchMarker);
                searchMarker = null; // marker'ı sıfırla
            }
            lat = e.latlng.lat;
            lon = e.latlng.lng;
            if (marker) {
                map.removeLayer(marker);
            }
            marker = L.marker(e.latlng).addTo(map);
            document.getElementById('coordinates').innerHTML = `Seçilen Konum: ${lat.toFixed(4)}, ${lon.toFixed(4)}`;
        });

        map.addControl(searchControl);

        let marker;
        let lat, lon;

        document.getElementById('dataForm').addEventListener('submit', function(e) {
            e.preventDefault();
            // Supabase bağlantısı devre dışı
            // ... (Supabase ile ilgili kodları kaldırdık) 

            showMessage('Veri başarıyla kaydedildi!', 'success'); // Supabase olmadan da mesaj gösteriyoruz.
            this.reset();
            if (marker) {
                map.removeLayer(marker);
            }
            document.getElementById('coordinates').innerHTML = '';
        });

        function showMessage(text, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.innerHTML = text;
            messageDiv.className = type;
        }
    </script>
</body>
</html>